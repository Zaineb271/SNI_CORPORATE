{% extends 'base.html' %}
{% load i18n humanize %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}{% trans 'Analyse Financière' %}{% endblock %}</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
</head>
<body>
    {% block content %}
    <div class="container mt-2" style="margin-left: 90px; margin-right: 0px;">
        <h1 class="mb-3" style="text-align: center; color: #d4af37;margin-right: 100px;">{% trans 'Analyse Financière' %}</h1>
        {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
        {% endif %}
        {% if table_data %}
        <div class="client-results" style="text-align: center;width: 100%;font-size: 0.7em;">
            <table class="table table-striped table-bordered text-center">
                <thead>
                    <tr>
                        
                        <th>Identification</th>
                        <th>Année</th>
                        <th>Nom/Raison Sociale</th>
                        <th>Secteur d'activité</th>
                        <th>Etats financiers</th>
                        <th>Indicateurs financiers</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in table_data %}
                        <tr>
                            <td>{{ row.numtiers }}</td>
                            <td>{{ row.Annee }}</td>
                            <td>{{ row.Raison_Sociale }}</td>
                            <td>{{ row.Secteurs }}</td>
                            <td><button class="btn" data-toggle="modal" data-target="#editIdModal">
                                <i class="fas fa-eye"></i>
                            </button></td>
                            <td><button class="btn" data-toggle="modal" data-target="#editIdIndicateur">
                                <i class="fas fa-eye"></i>
                            </button></td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
          </div>
          <!-- Etats financiers -->
           
           <div class="modal fade" id="editIdModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-xl modal-dialog-scrollable custom-modal-width" role="document" style="max-width: 90% !important;width: 90% !important;">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                      <div class="table-responsive">
                        <table class="table table-striped table-bordered text-center">
                            <thead class="thead-light">
                                <tr>
                                    <th colspan="5">Bilan Actif</th>
                                    <th colspan="5">Bilan Passif</th>
                                </tr>
                                <tr>
                                    <th>Rubrique</th>
                                    <th>N</th>
                                    <th>N-1</th>
                                    <th>Variation</th>
                                    <th>Variation(%)</th>
                                    <th>Rubrique</th>
                                    <th>N</th>
                                    <th>N-1</th>
                                    <th>Variation</th>
                                    <th>Variation(%)</th>
                                </tr>
                            </thead>
                            <tbody style="text-align: left;">
                                <tr>
                                    <td>TOTAL IMMOBILISATIONS INCORPORELLES</td><td>5776</td><td>4861</td><td>915</td><td>18,8</td>
                                    <td>CAPITAL SOCIAL</td><td>6903</td><td>5776</td><td>1127</td><td>19,5</td>
                                </tr>
                                <tr>
                                    <td>TOTAL IMMOBILISATIONS FINANCIERES</td><td>4841</td><td>4169</td><td>672</td><td>16,1</td>
                                    <td>TOTAL CAPITAUX PROPRES</td><td>3051</td><td>2849</td><td>202</td><td>7,1</td>
                                </tr>
                                <tr>
                                    <td>TOTAL IMMOBILISATIONS CORPORELLES</td><td>1211</td><td>1062</td><td>149</td><td>14</td>
                                    <td>TOTAL DETTES LMT ET RESSOURCES ASSIMILEES</td><td>4862</td><td>4523</td><td>339</td><td>7,5</td>
                                </tr>
                                <tr>
                                    <td>TOTAL ACTIFS IMMOBILISES</td><td>1600</td><td>1423</td><td>177</td><td>12,4</td>
                                    <td>TOTAL PASSIFS NON COURANTS</td><td>5922</td><td>5348</td><td>574</td><td>10,7</td>
                                </tr>
                                <tr>
                                    <td>TOTAL ACTIFS CIRCULANTS</td><td>1974</td><td>1816</td><td>158</td><td>8,7</td>
                                    <td>TOTAL PASSIFS COURANTS</td><td>4301</td><td>3908</td><td>393</td><td>10,1</td>
                                </tr>
                                <tr>
                                    <td>LIQUIDITE ET EQUIVALENT DE LIQUIDITE</td><td>5283</td><td>4443</td><td>840</td><td>18,9</td>
                                    <td>CONCOURS BANCAIRE</td><td>5863</td><td>4890</td><td>973</td><td>19,9</td>
                                </tr>
                                
                                <tr>
                                    <td>TOTAL ACTIF</td><td>20685</td><td>17774</td><td>2911</td><td>16,4</td>
                                    <td>TOTAL PASSIF</td><td>20685</td><td>17774</td><td>2911</td><td>16,4</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered text-center">
                            <thead class="thead-light">
                                <tr>
                                    <th colspan="5">Etat de résultat</th>
                                </tr>
                                <tr>
                                    <th>Rubrique</th>
                                    <th>N</th>
                                    <th>N-1</th>
                                    <th>Variation</th>
                                    <th>Variation(%)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>CHIFFRE D'AFFAIRES </td><td>8053</td><td>7658</td><td>395</td><td>5,2</td>
                                </tr>
                                <tr>
                                  <td>AUTRES PRODUITS</td><td>10997</td><td>10748</td><td>249</td><td>2,3</td>
                                </tr>
                                <tr>
                                    <td>TOTAL PRODUIT D'EXPLOITATION</td><td>8760</td><td>7900</td><td>860</td><td>10,9</td>
                                </tr>
                                <tr>
                                  <td>TOTAL ACHATS</td><td>3861</td><td>3670</td><td>191</td><td>5,2</td>
                                </tr>
                                <tr>
                                    <td>CHARGES DE PERSONNEL</td><td>11265</td><td>10374</td><td>891</td><td>8,6</td>
                                    
                                </tr>
                                <tr>
                                  <td>DOTATION AUX AMORTISSEMENTS ET PROVISIONS</td><td>3179</td><td>2755</td><td>424</td><td>15,4</td>
                                </tr>
                                <tr>
                                    <td>AUTRES CHARGES D'EXPLOITATION</td><td>1901</td><td>1654</td><td>247</td><td>14,9</td>
                                    
                                </tr>
                                <tr>
                                  <td>TOTAL CHARGES D'EXPLOITATION</td><td>5376</td><td>4999</td><td>377</td><td>7,5</td>
                                </tr>
                                <tr>
                                    <td>RESULTAT D'EXPLOITATION</td><td>7594</td><td>6795</td><td>799</td><td>11,8</td>
                                    
                                </tr>
                                <tr>
                                  <td>CHARGES FINANCIERS</td><td>45455</td><td>45454</td><td>747</td><td>11,2</td>
                                </tr>
                                <tr>
                                    <td>PRODUITS FINANCIERS</td><td>13481</td><td>11883</td><td>1598</td><td>13,4</td>
                                    
                                </tr>
                                <tr>
                                  <td>RESULTAT COURANT AVANT IMPOTS</td><td>11064</td><td>10388</td><td>676</td><td>6,5</td>
                                </tr>
                                <tr>
                                    <td>RESULTAT EXCEPTIONNEL</td><td>14283</td><td>12683</td><td>1600</td><td>12,6</td>
                                    
                                </tr>
                                <tr>
                                  <td>IMPOTS SUR LES BENEFICES</td><td>16047</td><td>13415</td><td>2632</td><td>19,6</td>
                                </tr>
                                <tr>
                                    <td> RESULTAT NET DE L'EXERCICE</td><td>14813</td><td>13374</td><td>1439</td><td>10,8</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <!-- Indicateurs financiers -->
        <div class="modal fade" id="editIdIndicateur" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-xl modal-dialog-scrollable custom-modal-width" role="document" style="max-width: 90% !important;width: 90% !important;">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <br>
                    <div class="table-wrapper" style="display: flex;justify-content: space-between;gap: 20px;">
                        <!-- Tableau 1 : Indicateurs Bilanciels -->
                        <table class="table table-striped table-bordered text-center align-middle" style="width: 48%;">
                            <thead class="thead-light">
                                <tr><th colspan="4" class="text-start">Indicateurs Bilanciels</th></tr>
                                <tr><th>Indicateur</th><th>N</th><th>N-1</th><th>Variation</th></tr>
                            </thead>
                            <tbody style="text-align: left;">
                                <tr><td>Fonds de roulement</td><td>417,56</td><td>374,11</td><td>11,61%</td></tr>
                                <tr><td>BFR (exploitation)</td><td>680,45</td><td>637,19</td><td>6,79%</td></tr>
                                <tr><td>BFR total</td><td>121,02</td><td>99,39</td><td>21,76%</td></tr>
                                <tr><td>Trésorerie nette</td><td>55,18</td><td>50,37</td><td>9,55%</td></tr>
                            </tbody>
                        </table>

                        <!-- Ligne verticale de séparation -->
                        <div class="vertical-separator"></div>

                        <!-- Tableau 2 : Indicateurs d'activité -->
                        <table class="table table-striped table-bordered text-center align-middle" style="width: 48%;">
                            <thead class="thead-light">
                                <tr><th colspan="4" class="text-start">Indicateurs d'activité</th></tr>
                                <tr><th>Indicateur</th><th>N</th><th>N-1</th><th>Variation</th></tr>
                            </thead>
                            <tbody style="text-align: left;">
                                <tr><td>Chiffre d'affaires</td><td>472,12</td><td>516,97</td><td>-8,68%</td></tr>
                                <tr><td>Marge commerciale</td><td>575,53</td><td>648,72</td><td>-11,28%</td></tr>
                                <tr><td>Résultat brut d'exploitation</td><td>689,43</td><td>694,03</td><td>-0,66%</td></tr>
                                <tr><td>Résultat d'exploitation</td><td>814,34</td><td>937,36</td><td>-13,12%</td></tr>
                                <tr><td>Résultat net</td><td>297,85</td><td>347,66</td><td>-14,33%</td></tr>
                                <tr><td>C.A.F.</td><td>1146,33</td><td>925,45</td><td>23,87%</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <br>
                    <div class="table-wrapper" style="display: flex;justify-content: space-between;gap: 20px;">
                        <table class="table table-striped table-bordered text-center align-middle" style="width: 48%;">
                            <thead class="thead-light">
                                <tr><th colspan="4" class="text-start">Ratios financiers</th></tr>
                                <tr><th>Indicateur</th><th>N</th><th>N-1</th><th>Variation</th></tr>
                            </thead>
                            <tbody style="text-align: left;">
                                <tr><td>Marge brute d'exploitation</td><td>299,85</td><td>265,36</td><td>13,00%</td></tr>
                                <tr><td>Rentabilité Financière</td><td>882,61</td><td>819,05</td><td>7,76%</td></tr>
                                <tr><td>Rentabilité Globale</td><td>492,10</td><td>534,35</td><td>-7,91%</td></tr>
                                <tr><td>Taux de couverture du BFR</td><td>127,57</td><td>102,17</td><td>24,86%</td></tr>
                            </tbody>
                        </table>

                        <div class="vertical-separator"></div>

                        <table class="table table-striped table-bordered text-center align-middle" style="width: 48%;">
                            <thead class="thead-light">
                                <tr><th colspan="4" class="text-start">Ratios financiers</th></tr>
                                <tr><th>Indicateur</th><th>N</th><th>N-1</th><th>Variation</th></tr>
                            </thead>
                            <tbody style="text-align: left;">
                                <tr><td>Dettes Financières / Fonds propres</td><td>1006,47</td><td>901,41</td><td>11,66%</td></tr>
                                <tr><td>Couverture des charges financières par l'EBE</td><td>336,86</td><td>345,64</td><td>-2,54%</td></tr>
                                <tr><td>Autonomie financière</td><td>909,82</td><td>728,70</td><td>24,86%</td></tr>
                                <tr><td>Liquidité générale</td><td>1056,93</td><td>888,22</td><td>18,99%</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
        {% else %}
          <p>Aucune donnée à afficher.</p>
        {% endif %}
    </div>

    {% endblock %}
</body>

</html>